CREATE TABLE locais (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    cidade TEXT,
    estado TEXT,
    UF TEXT,
    regiao TEXT,
    pais TEXT,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE estadios (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    estadio TEXT NOT NULL,
    capacidade INTEGER,
    local_id INTEGER NOT NULL,
    inauguracao TEXT,
    ativo BOOLEAN DEFAULT 1,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    atualizado_em TIMESTAMP,
    FOREIGN KEY (local_id) REFERENCES locais(ID)
);

CREATE TABLE clubes (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    clube TEXT NOT NULL,
    apelido TEXT,
    local_id INTEGER NOT NULL,
    fundacao TEXT,
    ativo BOOLEAN DEFAULT 1,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    atualizado_em TIMESTAMP,
    FOREIGN KEY (local_id) REFERENCES locais(ID)
);

CREATE TABLE campeonatos (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    campeonato TEXT NOT NULL,
    pais TEXT NOT NULL,
    entidade TEXT, -- CBF, CONMEBOL, FIFA, etc.
    tipo TEXT, -- 'nacional', 'estadual', 'internacional'
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE edicoes (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    campeonato_id INTEGER NOT NULL,
    ano INTEGER NOT NULL,
    data_inicio TEXT,
    data_fim TEXT,
    campeao_id INTEGER, -- clube vencedor
    vice_id INTEGER,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (campeonato_id) REFERENCES campeonatos(ID),
    FOREIGN KEY (campeao_id) REFERENCES clubes(ID),
    FOREIGN KEY (vice_id) REFERENCES clubes(ID)
);

CREATE TABLE partidas (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    edicao_id INTEGER NOT NULL,
    estadio_id INTEGER,
    data TEXT NOT NULL,
    hora TEXT,
    fase TEXT, -- 'Primeira Fase', 'Oitavas', 'Quartas', 'Semi', 'Final', etc.
    rodada INTEGER,
    mandante_id INTEGER NOT NULL,
    visitante_id INTEGER NOT NULL,
    mandante_placar INTEGER,
    visitante_placar INTEGER,
    mandante_penalti INTEGER,
    visitante_penalti INTEGER,
    prorrogacao BOOLEAN DEFAULT 0,
    publico INTEGER,
    renda REAL,
    arbitro TEXT,
    arbitro_assistente1 TEXT,
    arbitro_assistente2 TEXT,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    atualizado_em TIMESTAMP,
    FOREIGN KEY (edicao_id) REFERENCES edicoes(ID),
    FOREIGN KEY (estadio_id) REFERENCES estadios(ID),
    FOREIGN KEY (mandante_id) REFERENCES clubes(ID),
    FOREIGN KEY (visitante_id) REFERENCES clubes(ID),
    CHECK (mandante_id != visitante_id) -- Garante que time não joga contra si mesmo
);

CREATE TABLE estatisticas_partida (
    partida_id INTEGER,
    clube_id INTEGER,
    chutes INTEGER,
    chutes_no_alvo INTEGER,
    posse_de_bola TEXT,
    passes INTEGER,
    precisao_passes TEXT,
    faltas INTEGER,
    cartao_amarelo INTEGER,
    cartao_vermelho INTEGER,
    impedimentos INTEGER,
    escanteios INTEGER,
    PRIMARY KEY (partida_id, clube_id),
    FOREIGN KEY (partida_id) REFERENCES partidas(ID),
    FOREIGN KEY (clube_id) REFERENCES clubes(ID)
);

CREATE TABLE jogadores (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    apelido TEXT,
    nascimento TEXT,
    falecimento TEXT, -- Para jogadores históricos já falecidos
    nacionalidade TEXT,
    naturalidade TEXT, -- Cidade em que nasceu
    altura INTEGER, -- em centímetros
    peso INTEGER, -- em quilogramas
    posicao TEXT, -- 'Goleiro', 'Zagueiro', 'Lateral', 'Meia', 'Atacante'
    posicao_detalhada TEXT, -- 'Zagueiro Central', 'Ponta Esquerda', etc.
    pe_preferido TEXT, -- 'Direito', 'Esquerdo', 'Ambidestro'
    clube_atual_id INTEGER,
    aposentado BOOLEAN DEFAULT 0,
    url_foto TEXT,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    atualizado_em TIMESTAMP,
    FOREIGN KEY (clube_atual_id) REFERENCES clubes(ID)
);

CREATE TABLE jogadores_em_partida (
    partida_id INTEGER NOT NULL,
    jogador_id INTEGER NOT NULL,
    clube_id INTEGER NOT NULL, -- clube pelo qual jogou nesta partida
    titular BOOLEAN NOT NULL DEFAULT 1,
    posicao_jogada TEXT, -- Posição específica nesta partida
    numero_camisa INTEGER,
    minutos_jogados INTEGER,
    minuto_entrada INTEGER, -- Para reservas que entraram
    minuto_saida INTEGER, -- Para jogadores substituídos
    gols INTEGER DEFAULT 0,
    assistencias INTEGER DEFAULT 0,
    cartao_amarelo INTEGER DEFAULT 0,
    cartao_vermelho INTEGER DEFAULT 0,
    gol_contra INTEGER DEFAULT 0,
    penalti_cometido INTEGER DEFAULT 0,
    penalti_sofrido INTEGER DEFAULT 0,
    defesas INTEGER DEFAULT 0, -- Para goleiros
    faltas_cometidas INTEGER DEFAULT 0,
    faltas_sofridas INTEGER DEFAULT 0,
    impedimentos INTEGER DEFAULT 0,
    chutes_gol INTEGER DEFAULT 0,
    chutes_fora INTEGER DEFAULT 0,
    passes_completos INTEGER DEFAULT 0,
    passes_errados INTEGER DEFAULT 0,
    desarmes INTEGER DEFAULT 0,
    nota_avaliacao REAL, -- Nota de 0 a 10
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    atualizado_em TIMESTAMP,
    PRIMARY KEY (partida_id, jogador_id),
    FOREIGN KEY (partida_id) REFERENCES partidas(ID) ON DELETE CASCADE,
    FOREIGN KEY (jogador_id) REFERENCES jogadores(ID) ON DELETE CASCADE,
    FOREIGN KEY (clube_id) REFERENCES clubes(ID)
);

CREATE TABLE treinadores (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    nome TEXT NOT NULL,
    nome_completo TEXT,
    nascimento TEXT,
    falecimento TEXT,
    nacionalidade TEXT,
    clube_atual_id INTEGER,
    aposentado BOOLEAN DEFAULT 0,
    url_foto TEXT,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    atualizado_em TIMESTAMP,
    FOREIGN KEY (clube_atual_id) REFERENCES clubes(ID)
);

CREATE TABLE treinadores_em_partida (
    partida_id INTEGER NOT NULL,
    treinador_id INTEGER NOT NULL,
    clube_id INTEGER NOT NULL,
    tipo TEXT DEFAULT 'Titular', -- 'Titular', 'Assistente', 'Interino'
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (partida_id, treinador_id, clube_id),
    FOREIGN KEY (partida_id) REFERENCES partidas(ID) ON DELETE CASCADE,
    FOREIGN KEY (treinador_id) REFERENCES treinadores(ID) ON DELETE CASCADE,
    FOREIGN KEY (clube_id) REFERENCES clubes(ID)
);

CREATE TABLE eventos_partida (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    partida_id INTEGER NOT NULL,
    minuto INTEGER NOT NULL,
    tipo_evento TEXT NOT NULL, -- 'gol', 'cartao_amarelo', 'cartao_vermelho', 'substituicao', 'penalti'
    tipo_gol TEXT, -- 'penalti', 'contra', 'normal', 'cabeça'
    jogador_principal_id INTEGER NOT NULL,
    jogador_secundario_id INTEGER, -- Para assistências ou jogador que entrou na substituição
    clube_id INTEGER NOT NULL,
    descricao TEXT,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (partida_id) REFERENCES partidas(ID) ON DELETE CASCADE,
    FOREIGN KEY (jogador_principal_id) REFERENCES jogadores(ID),
    FOREIGN KEY (jogador_secundario_id) REFERENCES jogadores(ID),
    FOREIGN KEY (clube_id) REFERENCES clubes(ID)
);

CREATE TABLE transferencias (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    jogador_id INTEGER NOT NULL,
    clube_origem_id INTEGER,
    clube_destino_id INTEGER NOT NULL,
    data_transferencia TEXT NOT NULL,
    valor REAL, -- Valor da transferência
    tipo TEXT, -- 'Compra', 'Empréstimo', 'Livre', 'Troca'
    duracao_meses INTEGER, -- Para empréstimos
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (jogador_id) REFERENCES jogadores(ID),
    FOREIGN KEY (clube_origem_id) REFERENCES clubes(ID),
    FOREIGN KEY (clube_destino_id) REFERENCES clubes(ID)
);
