{% extends "layout.html" %}

{% block body %}

<!-- ===================================
     CABE√áALHO DA PARTIDA
     Mostra os times, placar e autores dos gols
     =================================== -->
<div class="match-header-wrapper">
    <div class="match-header-card">
        <!-- Time da Casa (Mandante) -->
        <div class="team team-home">
            <h2 class="team-name">
                <a href="/clube/{{ partida['mandante'] }}">{{ partida['mandante'] }}</a>
            </h2>
            <div class="team-score">{{ partida['gols_mandante'] }}</div>

            <!-- GOLS DO TIME MANDANTE -->
            {% if gols %}
                <div class="gols-list">
                    {% for gol in gols if gol['clube'] == partida['mandante'] %}
                        <div class="gol-item">
                            <span class="gol-icon">‚öΩ</span>
                            <span class="gol-jogador">{{ gol['jogador_apelido'] or gol['jogador_nome'] }}</span>
                            <span class="gol-minuto">{{ gol['minuto'] }}'</span>
                            {% if gol['tipo_gol'] and gol['tipo_gol'] != 'normal' %}
                                <span class="gol-tipo">({{ gol['tipo_gol'] }})</span>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Informa√ß√µes Centrais -->
        <div class="match-center">
            <div class="match-vs">X</div>

            <!-- Informa√ß√µes da Partida -->
            <div class="match-info">
                <div class="match-date">{{ partida['data'] }}</div>
                {% if partida['hora'] %}
                    <div class="match-time">{{ partida['hora'] }}</div>
                {% endif %}

                {% if partida['arena'] %}
                    <div class="match-venue">
                        <a href="{{ make_url_estadio(partida['estadio_id'], partida['arena']) }}">
                            üìç {{ partida['arena'] }}
                        </a>
                    </div>
                {% endif %}

                <div class="match-competition">
                    <span class="badge-round">{{ partida['rodada'] }}</span>
                    {{ partida['campeonato'] }} {{ partida['ano'] }}
                </div>

                <!-- Indicadores Especiais -->
                {% if partida['mandante_penalti'] is not none and partida['visitante_penalti'] is not none %}
                    <div class="match-penalties">
                        P√™naltis: {{ partida['mandante_penalti'] }} - {{ partida['visitante_penalti'] }}
                    </div>
                {% endif %}

                {% if partida['prorrogacao'] %}
                    <div class="match-overtime">Ap√≥s Prorroga√ß√£o</div>
                {% endif %}

                {% if partida['publico'] %}
                    <div class="match-attendance">
                        üë• {{ "{:,}".format(partida['publico']).replace(',', '.') }} pessoas
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Time Visitante -->
        <div class="team team-away">
            <h2 class="team-name">
                <a href="/clube/{{ partida['visitante'] }}">{{ partida['visitante'] }}</a>
            </h2>
            <div class="team-score">{{ partida['gols_visitante'] }}</div>

            <!-- GOLS DO TIME VISITANTE -->
            {% if gols %}
                <div class="gols-list">
                    {% for gol in gols if gol['clube'] == partida['visitante'] %}
                        <div class="gol-item">
                            <span class="gol-icon">‚öΩ</span>
                            <span class="gol-jogador">{{ gol['jogador_apelido'] or gol['jogador_nome'] }}</span>
                            <span class="gol-minuto">{{ gol['minuto'] }}'</span>
                            {% if gol['tipo_gol'] and gol['tipo_gol'] != 'normal' %}
                                <span class="gol-tipo">({{ gol['tipo_gol'] }})</span>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
</div>


<!-- ===================================
     ARBITRAGEM
     =================================== -->
{% if arbitros %}
<div class="section-card">
    <h3 class="section-title">
        <span class="section-icon">üë®‚Äç‚öñÔ∏è</span>
        Arbitragem
    </h3>
    <div class="arbitros-list">
        {% for arbitro in arbitros %}
            <div class="arbitro-chip">
                <a href="{{ make_url_arbitro(arbitro['arbitro_id'], arbitro['nome']) }}">
                    {{ arbitro['nome'] }}
                </a>
                {% if arbitro['naturalidade'] %}
                    <span class="origem">({{ arbitro['naturalidade'] }})</span>
                {% endif %}
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}


<!-- ===================================
     COMISS√ÉO T√âCNICA (TREINADORES)
     =================================== -->
{% if treinadores %}
<div class="section-card">
    <h3 class="section-title">
        <span class="section-icon">üìã</span>
        Comiss√£o T√©cnica
    </h3>
    <div class="treinadores-grid">
        {% for time in [partida['mandante'], partida['visitante']] %}
            <div class="treinador-team-box">
                <h4 class="team-subtitle">{{ time }}</h4>
                {% for treinador in treinadores if treinador['clube'] == time %}
                    <div class="treinador-item">
                        <a href="{{ make_url_treinador(treinador['treinador_id'], treinador['nome']) }}">
                            {{ treinador['nome'] }}
                        </a>
                        <span class="role">({{ treinador['tipo'] }})</span>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}


<!-- ===================================
     ESCALA√á√ïES
     =================================== -->
{% if jogadores_mandante or jogadores_visitante %}
<div class="section-card">
    <h3 class="section-title">
        <span class="section-icon">üëï</span>
        Escala√ß√µes
    </h3>
    <div class="escalacoes-grid">
        <!-- Mandante -->
        <div class="escalacao-team">
            <h4 class="team-subtitle">{{ partida['mandante'] }}</h4>

            <!-- Titulares -->
            <div class="players-group">
                <h5 class="players-group-title">Titulares</h5>
                {% for jogador in jogadores_mandante if jogador['titular'] %}
                    <div class="player-item">
                        {% if jogador['numero_camisa'] %}
                            <span class="player-number">{{ jogador['numero_camisa'] }}</span>
                        {% endif %}
                        <a href="{{ make_url_jogador(jogador['jogador_id'], jogador['apelido'] or jogador['nome']) }}" class="player-name">
                            {{ jogador['apelido'] or jogador['nome'] }}
                        </a>
                        {% if jogador['posicao_jogada'] %}
                            <span class="player-position">{{ jogador['posicao_jogada'] }}</span>
                        {% endif %}

                        <!-- Stats do jogador -->
                        <div class="player-stats">
                            {% if jogador['gols'] > 0 %}
                                <span class="stat-badge stat-goal" title="Gols">‚öΩ{{ jogador['gols'] }}</span>
                            {% endif %}
                            {% if jogador['assistencias'] > 0 %}
                                <span class="stat-badge stat-assist" title="Assist√™ncias">üéØ{{ jogador['assistencias'] }}</span>
                            {% endif %}
                            {% if jogador['cartao_amarelo'] > 0 %}
                                <span class="stat-badge stat-yellow" title="Cart√£o Amarelo">üü®</span>
                            {% endif %}
                            {% if jogador['cartao_vermelho'] > 0 %}
                                <span class="stat-badge stat-red" title="Cart√£o Vermelho">üü•</span>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Reservas -->
            {% set reservas = jogadores_mandante | selectattr('titular', 'equalto', 0) | list %}
            {% if reservas | length > 0 %}
                <div class="players-group">
                    <h5 class="players-group-title">Reservas</h5>
                    {% for jogador in reservas %}
                        <div class="player-item player-substitute">
                            {% if jogador['numero_camisa'] %}
                                <span class="player-number">{{ jogador['numero_camisa'] }}</span>
                            {% endif %}
                            <a href="{{ make_url_jogador(jogador['jogador_id'], jogador['apelido'] or jogador['nome']) }}" class="player-name">
                                {{ jogador['apelido'] or jogador['nome'] }}
                            </a>

                            <div class="player-stats">
                                {% if jogador['gols'] > 0 %}
                                    <span class="stat-badge stat-goal">‚öΩ{{ jogador['gols'] }}</span>
                                {% endif %}
                                {% if jogador['assistencias'] > 0 %}
                                    <span class="stat-badge stat-assist">üéØ{{ jogador['assistencias'] }}</span>
                                {% endif %}
                                {% if jogador['cartao_amarelo'] > 0 %}
                                    <span class="stat-badge stat-yellow">üü®</span>
                                {% endif %}
                                {% if jogador['cartao_vermelho'] > 0 %}
                                    <span class="stat-badge stat-red">üü•</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Visitante (mesma estrutura) -->
        <div class="escalacao-team">
            <h4 class="team-subtitle">{{ partida['visitante'] }}</h4>

            <div class="players-group">
                <h5 class="players-group-title">Titulares</h5>
                {% for jogador in jogadores_visitante if jogador['titular'] %}
                    <div class="player-item">
                        {% if jogador['numero_camisa'] %}
                            <span class="player-number">{{ jogador['numero_camisa'] }}</span>
                        {% endif %}
                        <a href="{{ make_url_jogador(jogador['jogador_id'], jogador['apelido'] or jogador['nome']) }}" class="player-name">
                            {{ jogador['apelido'] or jogador['nome'] }}
                        </a>
                        {% if jogador['posicao_jogada'] %}
                            <span class="player-position">{{ jogador['posicao_jogada'] }}</span>
                        {% endif %}

                        <div class="player-stats">
                            {% if jogador['gols'] > 0 %}
                                <span class="stat-badge stat-goal">‚öΩ{{ jogador['gols'] }}</span>
                            {% endif %}
                            {% if jogador['assistencias'] > 0 %}
                                <span class="stat-badge stat-assist">üéØ{{ jogador['assistencias'] }}</span>
                            {% endif %}
                            {% if jogador['cartao_amarelo'] > 0 %}
                                <span class="stat-badge stat-yellow">üü®</span>
                            {% endif %}
                            {% if jogador['cartao_vermelho'] > 0 %}
                                <span class="stat-badge stat-red">üü•</span>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>

            {% set reservas = jogadores_visitante | selectattr('titular', 'equalto', 0) | list %}
            {% if reservas | length > 0 %}
                <div class="players-group">
                    <h5 class="players-group-title">Reservas</h5>
                    {% for jogador in reservas %}
                        <div class="player-item player-substitute">
                            {% if jogador['numero_camisa'] %}
                                <span class="player-number">{{ jogador['numero_camisa'] }}</span>
                            {% endif %}
                            <a href="{{ make_url_jogador(jogador['jogador_id'], jogador['apelido'] or jogador['nome']) }}" class="player-name">
                                {{ jogador['apelido'] or jogador['nome'] }}
                            </a>

                            <div class="player-stats">
                                {% if jogador['gols'] > 0 %}
                                    <span class="stat-badge stat-goal">‚öΩ{{ jogador['gols'] }}</span>
                                {% endif %}
                                {% if jogador['assistencias'] > 0 %}
                                    <span class="stat-badge stat-assist">üéØ{{ jogador['assistencias'] }}</span>
                                {% endif %}
                                {% if jogador['cartao_amarelo'] > 0 %}
                                    <span class="stat-badge stat-yellow">üü®</span>
                                {% endif %}
                                {% if jogador['cartao_vermelho'] > 0 %}
                                    <span class="stat-badge stat-red">üü•</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}


<!-- ===================================
     ESTAT√çSTICAS DA PARTIDA
     =================================== -->
{% if estatisticas %}
<div class="section-card">
    <h3 class="section-title">
        <span class="section-icon">üìä</span>
        Estat√≠sticas da Partida
    </h3>
    <div class="stats-comparison">
        {% for stat_name, stat_label in [
            ('chutes', 'Chutes'),
            ('chutes_no_alvo', 'Chutes no Alvo'),
            ('posse_de_bola', 'Posse de Bola'),
            ('passes', 'Passes'),
            ('precisao_passes', 'Precis√£o de Passes'),
            ('escanteios', 'Escanteios'),
            ('impedimentos', 'Impedimentos'),
            ('faltas', 'Faltas'),
            ('cartao_amarelo', 'Cart√µes Amarelos'),
            ('cartao_vermelho', 'Cart√µes Vermelhos')
        ] %}
            {% set mandante_stat = estatisticas | selectattr('clube', 'equalto', partida['mandante']) | first %}
            {% set visitante_stat = estatisticas | selectattr('clube', 'equalto', partida['visitante']) | first %}

            {% if mandante_stat and visitante_stat and mandante_stat[stat_name] is not none %}
                <div class="stat-row">
                    <div class="stat-value stat-home-value">{{ mandante_stat[stat_name] }}</div>
                    <div class="stat-label-center">{{ stat_label }}</div>
                    <div class="stat-value stat-away-value">{{ visitante_stat[stat_name] }}</div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% else %}
    <div class="no-data-card">
        <div class="no-data-icon">üìä</div>
        <p class="no-data-text">Estat√≠sticas detalhadas n√£o dispon√≠veis para esta partida</p>
        <p class="no-data-subtext">Apenas o resultado final est√° registrado</p>
    </div>
{% endif %}


<!-- ===================================
     CART√ïES
     =================================== -->
{% if cartoes_amarelos or cartoes_vermelhos %}
<div class="section-card">
    <h3 class="section-title">
        <span class="section-icon">üé¥</span>
        Cart√µes
    </h3>
    <div class="cartoes-grid">
        {% if cartoes_amarelos %}
            <div class="cartoes-list">
                <h4 class="cartoes-subtitle">üü® Cart√µes Amarelos</h4>
                {% for cartao in cartoes_amarelos %}
                    <div class="cartao-item">
                        <span class="cartao-club">{{ cartao['clube'] }}</span>
                        <span class="cartao-player">{{ cartao['jogador_apelido'] or cartao['jogador_nome'] }}</span>
                        <span class="cartao-minute">{{ cartao['minuto'] }}'</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if cartoes_vermelhos %}
            <div class="cartoes-list">
                <h4 class="cartoes-subtitle">üü• Cart√µes Vermelhos</h4>
                {% for cartao in cartoes_vermelhos %}
                    <div class="cartao-item">
                        <span class="cartao-club">{{ cartao['clube'] }}</span>
                        <span class="cartao-player">{{ cartao['jogador_apelido'] or cartao['jogador_nome'] }}</span>
                        <span class="cartao-minute">{{ cartao['minuto'] }}'</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>
{% endif %}

{% endblock %}
